<div class="tracker-wrapper">
  <header class="tracker-header">
    <button class="btn-back" (click)="goBack()">â† Nazad</button>
    <h1>ğŸ“ Dnevna refleksija</h1>
    <button class="btn-add" (click)="showForm = !showForm">
      {{ showForm ? 'OtkaÅ¾i' : '+ Nova refleksija' }}
    </button>
  </header>

<div class="tracker-content">


  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-info">
        <h3>{{ getAverageRating() }}</h3>
        <p>ProsjeÄna ocjena</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ¯</div>
      <div class="stat-info">
        <h3>{{ getGoalsAchievedCount() }}</h3>
        <p>Postignuti ciljevi</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ“–</div>
      <div class="stat-info">
        <h3>{{ reflectionEntries.length }}</h3>
        <p>Ukupno refleksija</p>
      </div>
    </div>
  </div>

  <div class="add-form" *ngIf="showForm">
    <form [formGroup]="reflectionForm" (ngSubmit)="addReflectionEntry()">
      <div class="form-container">
        
        <div class="form-row">
          <div class="form-group">
            <label>ğŸ“… Datum</label>
            <input type="date" formControlName="date" />
          </div>
          <div class="form-group">
            <label>ğŸ• Vrijeme</label>
            <input type="time" formControlName="time" />
          </div>
        </div>

        <div class="form-group">
          <label>â­ Ocjena dana (1-10): {{ reflectionForm.get('rating')?.value }}</label>
          <input 
            type="range" 
            formControlName="rating" 
            min="1" 
            max="10" 
            class="rating-slider"
          />
          <div class="rating-labels">
            <span>1</span>
            <span>5</span>
            <span>10</span>
          </div>
        </div>

        <div class="form-group">
          <label>ğŸ“Š Kategorija</label>
          <div class="category-selector">
            <label 
              class="category-option" 
              *ngFor="let cat of categories"
            >
              <input 
                type="radio" 
                formControlName="category" 
                [value]="cat.value"
              />
              <span class="category-icon">{{ cat.icon }}</span>
              <span class="category-label">{{ cat.label }}</span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>ğŸ˜Š Kako se osjeÄ‡aÅ¡?</label>
          <div class="mood-selector">
            <label class="mood-option" *ngFor="let m of ['amazing', 'good', 'okay', 'rough']">
              <input 
                type="radio" 
                formControlName="mood" 
                [value]="m"
              />
              <span class="mood-emoji">{{ getMoodEmoji(m) }}</span>
              <span class="mood-label">{{ getMoodName(m) }}</span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>ğŸ’­ Å ta sam danas nauÄio?</label>
          <textarea 
            formControlName="whatLearned" 
            rows="3"
            placeholder="OpiÅ¡i nove spoznaje, vjeÅ¡tine ili iskustva..."
          ></textarea>
        </div>

        <div class="form-group">
          <label>ğŸ”„ Å ta bih sutra uradio drugaÄije?</label>
          <textarea 
            formControlName="whatToDoDifferently" 
            rows="3"
            placeholder="Razmisli o poboljÅ¡anjima i promjenama..."
          ></textarea>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="goalsAchieved" />
            <span>ğŸ¯ Postigao/la sam svoje dnevne ciljeve</span>
          </label>
        </div>

        <div class="form-group" *ngIf="reflectionForm.get('goalsAchieved')?.value">
          <label>Opis postignuÄ‡a</label>
          <textarea 
            formControlName="goalsDescription" 
            rows="2"
            placeholder="OpiÅ¡i koje si ciljeve postigao..."
          ></textarea>
        </div>

        <div class="form-group">
          <label>ğŸ† Pobjede dana</label>
          <div class="items-list">
            <div *ngFor="let win of wins.controls; let i = index" class="item-input-group">
              <input 
                type="text" 
                [formControl]="$any(win)" 
                [placeholder]="'Pobjeda ' + (i + 1)"
                class="item-input"
              />
              <button 
                type="button" 
                class="btn-remove-item" 
                (click)="removeWin(i)"
                *ngIf="wins.length > 1"
              >
                âœ•
              </button>
            </div>
          </div>
          <button 
            type="button" 
            class="btn-add-item" 
            (click)="addWin()"
            *ngIf="wins.length < 5"
          >
            â• Dodaj joÅ¡ pobjedu
          </button>
        </div>

        <div class="form-group">
          <label>ğŸ“š Lekcije dana</label>
          <div class="items-list">
            <div *ngFor="let lesson of lessons.controls; let i = index" class="item-input-group">
              <input 
                type="text" 
                [formControl]="$any(lesson)" 
                [placeholder]="'Lekcija ' + (i + 1)"
                class="item-input"
              />
              <button 
                type="button" 
                class="btn-remove-item" 
                (click)="removeLesson(i)"
                *ngIf="lessons.length > 1"
              >
                âœ•
              </button>
            </div>
          </div>
          <button 
            type="button" 
            class="btn-add-item" 
            (click)="addLesson()"
            *ngIf="lessons.length < 5"
          >
            â• Dodaj joÅ¡ lekciju
          </button>
        </div>

        <div class="form-group">
          <label>âœ¨ Slobodne misli</label>
          <textarea 
            formControlName="freeThoughts" 
            rows="5"
            placeholder="Bilo Å¡ta Å¡to Å¾eliÅ¡ da zapamtiÅ¡ o ovom danu..."
          ></textarea>
        </div>

        <button type="submit" class="btn-submit" [disabled]="reflectionForm.invalid">
          ğŸ’¾ SaÄuvaj refleksiju
        </button>
      </div>
    </form>
  </div>

  <div class="loading" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>UÄitavanje...</p>
  </div>

  <div class="entries-container" *ngIf="!isLoading">
    <div class="empty-state" *ngIf="reflectionEntries.length === 0">
      <div class="empty-icon">ğŸ“</div>
      <h2>Nema refleksija</h2>
      <p>ZapoÄni svoj dnevnik razmiÅ¡ljanja!</p>
    </div>

    <div class="entries-grid" *ngIf="reflectionEntries.length > 0">
      <div 
        *ngFor="let entry of reflectionEntries" 
        class="reflection-card"
      >
        <div class="card-header">
          <div class="card-info">
            <div class="card-date">
              <span class="date-text">{{ formatDate(entry.date) }}</span>
              <span class="time-text">{{ entry.time }}</span>
            </div>
            <div class="card-meta">
              <span class="category-badge">
                {{ getCategoryInfo(entry.category).icon }} {{ getCategoryInfo(entry.category).label }}
              </span>
              <span class="mood-badge">{{ getMoodEmoji(entry.mood) }}</span>
              <span class="rating-badge">â­ {{ entry.rating }}/10</span>
            </div>
          </div>
          <button class="btn-delete" (click)="deleteReflectionEntry(entry.id)">ğŸ—‘ï¸</button>
        </div>

        <div class="card-body">
          
          <div class="goals-badge" *ngIf="entry.goalsAchieved">
            ğŸ¯ Ciljevi postignuti
          </div>

          <div class="reflection-section">
            <h4>ğŸ’­ Å ta sam danas nauÄio</h4>
            <p>{{ entry.whatLearned }}</p>
          </div>

          <div class="reflection-section">
            <h4>ğŸ”„ Å ta bih uradio drugaÄije</h4>
            <p>{{ entry.whatToDoDifferently }}</p>
          </div>

          <div class="reflection-section" *ngIf="entry.goalsDescription">
            <h4>ğŸ¯ Postignuti ciljevi</h4>
            <p>{{ entry.goalsDescription }}</p>
          </div>

          <div class="reflection-section">
            <h4>ğŸ† Pobjede</h4>
            <ul class="wins-list">
              <li *ngFor="let win of entry.wins">{{ win }}</li>
            </ul>
          </div>

          <div class="reflection-section">
            <h4>ğŸ“š Lekcije</h4>
            <ul class="lessons-list">
              <li *ngFor="let lesson of entry.lessons">{{ lesson }}</li>
            </ul>
          </div>

          <div class="reflection-section highlight">
            <h4>âœ¨ Slobodne misli</h4>
            <p>{{ entry.freeThoughts }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>